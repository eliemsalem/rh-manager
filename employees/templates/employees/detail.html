{% extends "employees/base.html" %}
{% load static %}
{% block title %}Edit Employee Â· HR Manager{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row g-4">
    <!-- Main Form -->
    <div class="col-lg-8">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white">
          <i class="bi bi-person-badge"></i> Edit Employee
        </div>
        <div class="card-body">
          <form method="post" novalidate>
            {% csrf_token %}

            <!-- Global Error Message -->
            {% if form.errors %}
              <div class="alert alert-danger">
                <strong>Please correct the errors below:</strong>
                <ul class="mb-0">
                  {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                      <li><strong>{{ field|capfirst }}</strong>: {{ error }}</li>
                    {% endfor %}
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <!-- General Information -->
            <h6 class="border-bottom pb-2 mb-3 text-muted">General Information</h6>
            <div class="row g-3">
              <div class="col-md-6">
                {{ form.prenom.label_tag }} {{ form.prenom }}
                {% if form.prenom.errors %}
                  <div class="text-danger small">{{ form.prenom.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                {{ form.nom.label_tag }} {{ form.nom }}
                {% if form.nom.errors %}
                  <div class="text-danger small">{{ form.nom.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                {{ form.email.label_tag }} {{ form.email }}
                {% if form.email.errors %}
                  <div class="text-danger small">{{ form.email.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                {{ form.project.label_tag }} {{ form.project }}
                {% if form.project.errors %}
                  <div class="text-danger small">{{ form.project.errors }}</div>
                {% endif %}
              </div>
            </div>

            <!-- Contract -->
            <h6 class="border-bottom pb-2 mt-4 mb-3 text-muted">Contract Details</h6>
            <div class="row g-3">
              <div class="col-md-6">{{ form.contract_type.label_tag }} {{ form.contract_type }}{% if form.contract_type.errors %}<div class="text-danger small">{{ form.contract_type.errors }}</div>{% endif %}</div>
              <div class="col-md-6">{{ form.contract_company.label_tag }} {{ form.contract_company }}{% if form.contract_company.errors %}<div class="text-danger small">{{ form.contract_company.errors }}</div>{% endif %}</div>
              <div class="col-md-6">{{ form.title.label_tag }} {{ form.title }}{% if form.title.errors %}<div class="text-danger small">{{ form.title.errors }}</div>{% endif %}</div>
              <div class="col-md-6">{{ form.accomodation.label_tag }} {{ form.accomodation }}{% if form.accomodation.errors %}<div class="text-danger small">{{ form.accomodation.errors }}</div>{% endif %}</div>
            </div>

            <!-- Banking -->
            <h6 class="border-bottom pb-2 mt-4 mb-3 text-muted">Bank Information</h6>
            <div class="row g-3">
              <div class="col-md-6">{{ form.bank_name.label_tag }} {{ form.bank_name }}{% if form.bank_name.errors %}<div class="text-danger small">{{ form.bank_name.errors }}</div>{% endif %}</div>
              <div class="col-md-6">{{ form.bank_country.label_tag }} {{ form.bank_country }}{% if form.bank_country.errors %}<div class="text-danger small">{{ form.bank_country.errors }}</div>{% endif %}</div>
              <div class="col-md-6">{{ form.iban.label_tag }} {{ form.iban }}{% if form.iban.errors %}<div class="text-danger small">{{ form.iban.errors }}</div>{% endif %}</div>
              <div class="col-md-6">{{ form.swift.label_tag }} {{ form.swift }}{% if form.swift.errors %}<div class="text-danger small">{{ form.swift.errors }}</div>{% endif %}</div>
            </div>

            <!-- Other Details -->
            <h6 class="border-bottom pb-2 mt-4 mb-3 text-muted">Additional Details</h6>
            <div class="row g-3">
              <div class="col-md-6">{{ form.country.label_tag }} {{ form.country }}{% if form.country.errors %}<div class="text-danger small">{{ form.country.errors }}</div>{% endif %}</div>
              <div class="col-md-6">{{ form.salaire_net.label_tag }} {{ form.salaire_net }}{% if form.salaire_net.errors %}<div class="text-danger small">{{ form.salaire_net.errors }}</div>{% endif %}</div>
              <div class="col-md-6">{{ form.devise.label_tag }} {{ form.devise }}{% if form.devise.errors %}<div class="text-danger small">{{ form.devise.errors }}</div>{% endif %}</div>

              <!-- Active switch -->
              <div class="col-md-6">
                <label class="form-label d-block">Employment Status</label>
                <div class="form-check form-switch">
                  {{ form.actif }}
                  <label class="form-check-label" for="{{ form.actif.id_for_label }}">
                    {% if form.instance.actif %}âœ… Active employee{% else %}ðŸš« Inactive employee{% endif %}
                  </label>
                </div>
                {% if form.actif.errors %}
                  <div class="text-danger small">{{ form.actif.errors }}</div>
                {% endif %}
              </div>

              <div class="col-12">{{ form.comment.label_tag }} {{ form.comment }}{% if form.comment.errors %}<div class="text-danger small">{{ form.comment.errors }}</div>{% endif %}</div>
            </div>

            <!-- Buttons -->
            <div class="d-flex justify-content-between align-items-center mt-4">
              <div class="btn-group">
                <button class="btn btn-primary" type="submit" id="saveBtn">
                  <i class="bi bi-check2-circle"></i> Save
                </button>
                <a class="btn btn-outline-secondary" href="{% url 'employees:employee_list' %}">
                  <i class="bi bi-x-circle"></i> Cancel
                </a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Side Actions -->
    <div class="col-lg-4">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-light">
          <i class="bi bi-gear"></i> Actions
        </div>
        <div class="card-body">
          <a class="btn btn-outline-danger w-100"
             href="{% url 'employees:employee_delete' employee.pk %}"
             onclick="return confirm('Are you sure you want to delete this employee?');">
            <i class="bi bi-trash"></i> Delete Employee
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Spinner on Save -->
<script>
  document.querySelector("#saveBtn").addEventListener("click", e => {
    e.target.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Saving...';
  });
</script>
{% endblock %}
