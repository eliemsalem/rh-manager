{% extends "employees/base.html" %}
{% load static %}
{% block title %}Edit Employee Â· HR Manager{% endblock %}

{% block content %}
<div class="container-fluid mt-4" style="max-width: 95%;">
  <div class="row g-4">
    <!-- Main Form -->
    <div class="col-lg-9">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white">
          <i class="bi bi-person-badge"></i> Edit Employee
        </div>
        <div class="card-body">
          <form method="post" novalidate>
            {% csrf_token %}

            {% if form.errors %}
              <div class="alert alert-danger">
                <strong>Please correct the errors below:</strong>
                <ul class="mb-0">
                  {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                      <li><strong>{{ field|capfirst }}</strong>: {{ error }}</li>
                    {% endfor %}
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <!-- General Information -->
            <h6 class="border-bottom pb-2 mb-3 text-muted">General Information</h6>
            <div class="row g-3">
              <div class="col-md-6">{{ form.prenom.label_tag }} {{ form.prenom }}</div>
              <div class="col-md-6">{{ form.nom.label_tag }} {{ form.nom }}</div>
              <div class="col-md-6">{{ form.zoho_id.label_tag }} {{ form.zoho_id }}</div>
              <div class="col-md-6">{{ form.project.label_tag }} {{ form.project }}</div>
              <div class="col-md-6">{{ form.title.label_tag }} {{ form.title }}</div>
              <div class="col-md-6">{{ form.email.label_tag }} {{ form.email }}</div>
              <div class="col-md-6">{{ form.country.label_tag }} {{ form.country }}</div>
              <div class="col-md-6">{{ form.lead_1.label_tag }} {{ form.lead_1 }}</div>
            </div>

            <!-- Employment Dates -->
            <h6 class="border-bottom pb-2 mt-4 mb-3 text-muted">Employment Dates</h6>
            <div class="row g-3">
              <div class="col-md-4">{{ form.pt_date.label_tag }} {{ form.pt_date }}</div>
              <div class="col-md-4">{{ form.ft_date.label_tag }} {{ form.ft_date }}</div>
              <div class="col-md-4">{{ form.last_day.label_tag }} {{ form.last_day }}</div>
            </div>

            <!-- Compensation -->
            <h6 class="border-bottom pb-2 mt-4 mb-3 text-muted">Compensation</h6>
            <div class="row g-3">
              <div class="col-md-6">{{ form.salaire_net.label_tag }} {{ form.salaire_net }}</div>
              <div class="col-md-6">{{ form.devise.label_tag }} {{ form.devise }}</div>
            </div>

            <!-- Contract -->
            <h6 class="border-bottom pb-2 mt-4 mb-3 text-muted">Contract Details</h6>
            <div class="row g-3">
              <div class="col-md-6">{{ form.contract_type.label_tag }} {{ form.contract_type }}</div>
              <div class="col-md-6">{{ form.contract_company.label_tag }} {{ form.contract_company }}</div>
              <div class="col-md-6">{{ form.accomodation.label_tag }} {{ form.accomodation }}</div>
            </div>

            <!-- Bank Information -->
            <h6 class="border-bottom pb-2 mt-4 mb-3 text-muted">Bank Information</h6>
            <div class="row g-3">
              <div class="col-md-6">{{ form.bank_name.label_tag }} {{ form.bank_name }}</div>
              <div class="col-md-6">{{ form.bank_country.label_tag }} {{ form.bank_country }}</div>
              <div class="col-md-6">{{ form.iban.label_tag }} {{ form.iban }}</div>
              <div class="col-md-6">{{ form.swift.label_tag }} {{ form.swift }}</div>
            </div>

            <!-- Other Fields -->
            <h6 class="border-bottom pb-2 mt-4 mb-3 text-muted">Other Details</h6>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label d-block">Employment Status</label>
                <div class="form-check form-switch">
                  {{ form.actif }}
                  <label class="form-check-label" for="{{ form.actif.id_for_label }}">
                    {% if form.instance.actif %}âœ… Active employee{% else %}ðŸš« Inactive employee{% endif %}
                  </label>
                </div>
              </div>

              <!-- âœ… Read-only Import Date -->
              <div class="col-md-6">
                <label class="form-label">Import Date</label>
                <input type="text" class="form-control" value="{{ employee.date_import|date:'Y-m-d H:i' }}" readonly>
              </div>

              <div class="col-12">{{ form.comment.label_tag }} {{ form.comment }}</div>
            </div>

            <!-- Buttons -->
            <div class="d-flex justify-content-between align-items-center mt-4">
              <div class="btn-group">
                <button class="btn btn-primary" type="submit" id="saveBtn">
                  <i class="bi bi-check2-circle"></i> Save
                </button>
                <a class="btn btn-outline-secondary" href="{% url 'employees:employee_list' %}">
                  <i class="bi bi-x-circle"></i> Cancel
                </a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Side Actions -->
    <div class="col-lg-3">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-light">
          <i class="bi bi-gear"></i> Actions
        </div>
        <div class="card-body">
          <a class="btn btn-outline-danger w-100"
             href="{% url 'employees:employee_delete' employee.pk %}"
             onclick="return confirm('Are you sure you want to delete this employee?');">
            <i class="bi bi-trash"></i> Delete Employee
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.querySelector("#saveBtn").addEventListener("click", e => {
    e.target.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Saving...';
  });
</script>
{% endblock %}
